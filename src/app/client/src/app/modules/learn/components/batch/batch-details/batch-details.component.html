
<!-- Join Course Table -->
<sui-modal *ngIf="showJoinModal && !courseMentor" [mustScroll]="true" [isClosable]="true" [transitionDuration]="0" [size]="'normal'"
    class="sb-modal" appBodyScroll (dismissed)="showJoinModal = !showJoinModal" #modal>
    <div class="sb-modal-header">
        Select batch
    </div>
    <div class="sb-modal-content" *ngIf="showAllBatchList">
        <div class="join-batch">
            <div class="join-batch__heading">
                <div>Available batches</div>
                <div>Created by</div>
            </div>
            <div class="join-batch__body" *ngFor="let batch of allBatchList">
                <div>{{batch.startDate | dateFormat}}<span *ngIf="batch.endDate"> - {{batch.endDate | dateFormat}}
                    </span></div>
                <div *ngIf="userNames[batch.createdBy]">{{userNames[batch.createdBy].firstName}}
                    {{userNames[batch.createdBy].lastName}}</div>
                <button [disabled]="isEnrollmentAllowed(batch?.enrollmentEndDate)"
                    [ngClass]="{'sb-btn-disabled': isEnrollmentAllowed(batch?.enrollmentEndDate), 'sb-btn-primary': !isEnrollmentAllowed(batch.enrollmentEndDate)}"
                    class="sb-btn sb-btn-outline-secondary sb-btn-normal" appTelemetryInteract
                    [telemetryInteractEdata]="enrollBatchIntractEdata"
                    [telemetryInteractObject]="{id:batch.identifier,type:'CourseBatch',ver:'1',rollup:{l1:courseId}}"
                    (click)="enrollBatch(batch)" *ngIf="!courseMentor">Join</button>
            </div>
        </div>
    </div>
    <div *ngIf="showAllBatchError">
        <div class="sb-no-batch-found">{{resourceService.messages.stmsg.m0081}}</div>
    </div>
</sui-modal>

<!-- create batch -->
<sui-accordion class="styled fluid sb-accordion mb-16" *ngIf="courseMentor">
    <sui-accordion-panel [isOpen]="true">
        <div title class="sb-accordion-title fsmall d-flex flex-ai-center">
            {{resourceService?.frmelmnts?.lbl?.batches}}
            <i class="chevron down icon ml-auto"></i>
        </div>
        <div content class="sb-accordion-content sb-bg-color-white pt-0 pb-16">
            <div class="batch-details">
                <div class="mb-16" *ngIf="showBatchList">
                    <div class="batch-details__dropdown">
                        <sui-select (selectedOptionChange)="getAllBatchDetails()" class="selection mb-16"
                            [(ngModel)]="batchStatus" [options]="statusOptions" valueField="value" labelField="name"
                            #batchStatusSelect>
                            <sui-select-option *ngFor="let option of batchStatusSelect?.filteredOptions"
                                [value]="option">
                            </sui-select-option>
                        </sui-select>
                        <div *ngFor="let batch of batchList">
                            <div class="batch-details__edit d-flex flex-ai-center">
                                <div class="sb-color-primary fmedium font-weight-bold"><i
                                        class="calendar outline icon"></i> {{batch.startDate | dateFormat}}
                                    <span *ngIf="batch.endDate"> - {{batch.endDate | dateFormat}} </span></div>
                                <button class="sb-btn sb-btn-link sb-btn-link-primary sb-btn-normal ml-auto"
                                    appTelemetryInteract [telemetryInteractEdata]="updateBatchIntractEdata"
                                    [telemetryInteractObject]="{id:batch.identifier,type:'CourseBatch',ver:'1',rollup:{l1:courseId}}"
                                    (click)="batchUpdate(batch)">
                                    Edit
                                </button>
                            </div>
                            <div class="batch-details__created mt-8 fsmall" *ngIf="userNames[batch.createdBy]">Created
                                by {{userNames[batch.createdBy].firstName}} {{userNames[batch.createdBy].lastName}}
                            </div>
                            <div class="batch-details__created mt-8 fsmall"
                                *ngIf="isValidEnrollmentEndDate(batch.enrollmentEndDate)">
                                <span class="sb-label-12size"
                                    *ngIf="!isEnrollmentAllowed(batch.enrollmentEndDate)">{{resourceService.messages.stmsg.m0136}}
                                    {{batch.enrollmentEndDate | dateFormat}}</span>
                                <span class="sb-label-status-error"
                                    *ngIf="isEnrollmentAllowed(batch.enrollmentEndDate)">{{resourceService.messages.stmsg.m0134}}</span>
                            </div>
                        </div>
                    </div>
                    <div class="content my-15" *ngIf="batchList.length <= 0">
                        <div class="sb-no-batch-found">{{resourceService.messages.stmsg.m0081}}</div>
                    </div>
                </div>
                <div *ngIf="showError">
                    <div class="sb-no-batch-found">{{resourceService.messages.stmsg.m0081}}</div>
                </div>
                <div class="batch-deatils__button text-right">
                    <button class="sb-btn sb-btn-primary sb-btn-normal width-100"
                        [telemetryInteractObject]="courseInteractObject" (click)="createBatch()"
                        *ngIf="showCreateBatch()" appTelemetryInteract
                        [telemetryInteractEdata]="createBatchIntractEdata">{{resourceService.frmelmnts.lbl.createbatch}}</button>
                </div>
            </div>
        </div>
    </sui-accordion-panel>
</sui-accordion>

<!-- Leave batch card -->
<sui-accordion class="styled fluid sb-accordion mb-16" *ngIf="enrolledCourse && enrolledBatchInfo">
    <sui-accordion-panel [isOpen]="false">
        <div title class="sb-accordion-title fsmall d-flex flex-ai-center">
            {{resourceService.frmelmnts.lbl.batchdetails}}
            <i class="chevron down icon ml-auto"></i>
        </div>
        <div content class="sb-accordion-content sb-bg-color-white pt-0 pb-16">
            <div class="batch-details">
                <div class="mb-16">
                    <div class="batch-details__name sb-color-primary font-weight-bold fmedium">
                        {{enrolledBatchInfo?.name}}</div>
                    <div class="batch-details__created mt-8 fsmall">
                        <span class="date">{{enrolledBatchInfo.startDate | dateFormat}} </span>
                        <span *ngIf="enrolledBatchInfo.endDate" class="date"> -
                            {{enrolledBatchInfo?.endDate | dateFormat}}</span>
                    </div>
                </div>
                <div class="batch-deatils__button text-right">
                    <button
                        [ngClass]="{'sb-btn-disabled': isUnenrollbtnDisabled,'sb-btn-outline-primary': !isUnenrollbtnDisabled}"
                        class="sb-btn sb-btn-outline-primary sb-btn-normal" appTelemetryInteract
                        [telemetryInteractEdata]="unenrollBatchIntractEdata"
                        [telemetryInteractObject]="{id:enrolledBatchInfo.identifier,type:'CourseBatch',ver:'1',rollup:{l1:courseId}}"
                        (click)="unenrollBatch(enrolledBatchInfo)"
                        [disabled]="isUnenrollbtnDisabled">{{resourceService.frmelmnts.btn.unenroll}}</button>
                </div>
                <div class="mb-16">
                    <div class="batch-details__created mt-8 fsmall">
                        <span class="right floated" *ngIf="enrolledBatchInfo?.participantCount>=0">
                            {{enrolledBatchInfo?.participantCount}} {{resourceService.frmelmnts.lbl.learners}}
                        </span>
                        <span>
                            {{enrolledBatchInfo?.mentors?.length}} {{resourceService.frmelmnts.lbl.mentors}}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </sui-accordion-panel>
</sui-accordion>