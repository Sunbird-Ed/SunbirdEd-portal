{"version":3,"file":"sunbird-web-extension.js.map","sources":["ng://sunbird-web-extension/models.ts","ng://sunbird-web-extension/plugin-service.ts","ng://sunbird-web-extension/extension-point.directive.ts","ng://sunbird-web-extension/BootstrapFramework.ts","ng://sunbird-web-extension/app.module.ts"],"sourcesContent":["export function PluginConfig(config) {\n  return function(type) {\n    type._pluginConfig = config;\n  };\n}\n\nexport class PluginPlacement {\n  public name;\n  public priority;\n  public component;\n  constructor(options) {\n    this.name = options.name;\n    this.priority = options.priority;\n    this.component = options.component;\n  }\n}\n\nexport class PluginData {\n  public plugin;\n  public placement;\n  constructor(plugin, placement) {\n    this.plugin = plugin;\n    this.placement = placement;\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { PluginData, PluginPlacement } from './models';\nimport { ReplaySubject } from 'rxjs';\n\nexport interface IPluginData {\n  type: IPluginClass;\n  config: IPluginClass['_pluginConfig'];\n  instance: new () => IPluginClass;\n}\n\nexport interface IPluginClass {\n  new();\n  _pluginConfig?: IPluginConfig;\n}\n\nexport interface IPluginConfig {\n  name: string;\n  description: string;\n  placements: Array<PluginPlacement>;\n}\n\n\n@Injectable()\nexport class PluginService {\n  public plugins: Array<IPluginData>;\n  public change;\n  private config;\n\n  constructor() {\n    this.plugins = [];\n    this.change = new ReplaySubject(1);\n  }\n\n  loadPlugins(config: any): void {\n    if (!config || !Array.isArray(config.plugins)) {\n      throw new Error('invalid framework configuration! Failed to load plugins!');\n    }\n\n    const plugins = config.plugins.map((data) => data.main);\n    for (const plugin of plugins) {\n      this.loadPlugin(plugin);\n    }\n  }\n\n  loadPlugin(plugin: IPluginClass): void {\n    const pluginData: IPluginData = {\n      type: plugin,\n      config: plugin._pluginConfig,\n      instance: new plugin()\n    };\n    this.plugins = this.plugins.concat([pluginData]);\n    this.change.next(this.plugins);\n  }\n\n  removePlugin(name: string): void {\n    const plugin = this.plugins.find((pluginObj) => pluginObj.config.name === name);\n    if (plugin) {\n      const plugins = this.plugins.slice();\n      plugins.splice(plugins.indexOf(plugin), 1);\n      this.plugins = plugins;\n      this.change.next(this.plugins);\n    }\n  }\n\n  getPluginData(name: string): Array<PluginData> {\n    return this.plugins.reduce((components, pluginData) => {\n      return components.concat(\n        pluginData.config.placements\n          .filter((placement) => placement.name === name)\n          .map((placement) => new PluginData(pluginData, placement))\n      );\n    }, []);\n  }\n}\n","import {\n  Directive, Input, Inject, Provider, ViewContainerRef,\n  ComponentFactoryResolver, ReflectiveInjector, OnDestroy, OnChanges, EventEmitter, Output, OnInit, ComponentRef\n} from '@angular/core';\nimport { PluginData } from './models';\nimport { PluginService } from './plugin-service';\nimport { Subscription } from 'rxjs';\n\n@Directive({\n  // tslint:disable-next-line:directive-selector\n  selector: 'extension-point'\n})\nexport class ExtensionPointDirective implements OnInit, OnChanges, OnDestroy {\n  @Input() name: string;\n  @Input() override: Boolean = false;\n  @Input() input: any;\n  @Output() output: EventEmitter<any> = new EventEmitter();\n  public viewContainerRef: ViewContainerRef;\n  public componentResolver: ComponentFactoryResolver;\n  public pluginService: PluginService;\n  public componentRefs: Array<any> = [];\n  public pluginChangeSubscription: Subscription;\n\n  constructor(viewContainerRef: ViewContainerRef, componentResolver: ComponentFactoryResolver,\n    pluginService: PluginService) {\n    this.viewContainerRef = viewContainerRef;\n    this.componentResolver = componentResolver;\n    this.pluginService = pluginService;\n    this.pluginChangeSubscription = this.pluginService.change.subscribe(x => this.initialize());\n  }\n\n  ngOnInit() {\n    this.initialize();\n  }\n\n  public initialize() {\n    if (!this.name) {\n      return;\n    }\n    const pluginData = this.pluginService.getPluginData(this.name);\n    if (this.override) {\n      pluginData.sort((a, b) => a.placement.priority > b.placement.priority ? 1 : a.placement.priority < b.placement.priority ? -1 : 0);\n      return this.instantiatePluginComponent(pluginData.shift());\n    } else {\n      pluginData.sort((a, b) => a.placement.priority > b.placement.priority ? 1 : a.placement.priority < b.placement.priority ? -1 : 0);\n      return Promise.all(pluginData.map(plugin => this.instantiatePluginComponent(plugin)));\n    }\n  }\n\n  public instantiatePluginComponent(pluginData: PluginData): ComponentRef<any> {\n    if (!pluginData) {\n      return;\n    }\n    const componentFactory = this.componentResolver.resolveComponentFactory(pluginData.placement.component);\n    const contextInjector = this.viewContainerRef.parentInjector;\n    const providers = [{ provide: PluginData, useValue: pluginData }];\n    const childInjector = ReflectiveInjector.resolveAndCreate(providers, contextInjector);\n    const componentRef: any = this.viewContainerRef.createComponent(componentFactory, this.viewContainerRef.length, childInjector);\n    componentRef.instance.input = this.input;\n    componentRef.instance.output = componentRef.instance.output || new EventEmitter();\n    componentRef.instance.output.subscribe(childComponentEvent => this.output.emit(childComponentEvent));\n    this.componentRefs.push(componentRef);\n    componentRef.changeDetectorRef.markForCheck();\n    componentRef.changeDetectorRef.detectChanges();\n    return componentRef;\n  }\n\n  ngOnChanges() {\n    if (this.componentRefs.length > 0) {\n      this.componentRefs.forEach(componentRef => {\n        componentRef.instance.input = this.input;\n        return componentRef.instance.ngOnChanges ? componentRef.instance.ngOnChanges() : undefined;\n      });\n    }\n  }\n\n  ngOnDestroy() {\n    if (this.componentRefs.length > 0) {\n      this.componentRefs.forEach(componentRef => componentRef.destroy());\n      this.componentRefs = [];\n    }\n    this.pluginChangeSubscription.unsubscribe();\n  }\n}\n","import { PluginService } from './plugin-service';\nimport { Injectable } from '@angular/core';\n\n@Injectable()\nexport class BootstrapFramework {\n\n  private config: any;\n\n  private pluginService: PluginService;\n\n  constructor(pluginService: PluginService) {\n    this.pluginService = pluginService;\n  }\n\n  initialize(config: any) {\n    this.config = config;\n    this.pluginService.loadPlugins(this.config);\n  }\n}\n","import { ExtensionPointDirective } from './extension-point.directive';\nimport { NgModule, ModuleWithProviders } from '@angular/core';\nimport { PluginService } from './plugin-service';\nimport { BootstrapFramework } from './BootstrapFramework';\nimport { CommonModule } from '@angular/common';\n\n@NgModule({\n  declarations: [\n    ExtensionPointDirective\n  ],\n  imports: [\n    CommonModule\n  ],\n  exports: [\n    ExtensionPointDirective\n  ]\n})\nexport class WebExtensionModule {\n  static forRoot(): ModuleWithProviders {\n    return {\n      ngModule: WebExtensionModule,\n      providers: [PluginService, BootstrapFramework]\n    };\n  }\n}\n\n\n"],"names":[],"mappings":"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"}
