org.ekstep.contenteditor.jQuery("body").append($("<script type='text/javascript' src='/content-plugins/org.ekstep.conceptselector-1.0/editor/semantic-ui-tree-picker.js'>"))
org.ekstep.contenteditor.jQuery("head").append("<link rel='stylesheet' type='text/css' href='/content-plugins/org.ekstep.conceptselector-1.0/editor/semantic-ui-tree-picker.css'>")
org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.conceptselector","ver":"1.0","author":"Santhosh Vasabhaktula","title":"Concept Selector Plugin","description":"","publishedDate":"","editor":{"main":"editor/plugin.js","dependencies":[{"type":"js","src":"editor/semantic-ui-tree-picker.js"},{"type":"css","src":"editor/semantic-ui-tree-picker.css"}]}},eval('org.ekstep.contenteditor.basePlugin.extend({conceptData:void 0,callback:void 0,limit:200,selectors:[],concepts:[],initialize:function(){var e=this;e.getConcept(0,e.limit,e,function(){e.initData(e)}),ecEditor.addEventListener(e.manifest.id+":init",this.initConceptBrowser,this)},initData:function(e){function t(e,i){var n=[];return ecEditor._.forEach(i,function(c){if(void 0!=c.parent&&c.parent[0]==e){var a={};a.id=c.identifier,a.name=c.name,a.selectable="selectable",a.nodes=t(c.identifier,i),n.push(a)}}),ecEditor._.uniqBy(n,"id")}var e=e||this,i=[],n={request:{filters:{objectType:["Dimension","Domain"]}}};ecEditor.getService("search").search(n,function(n,c){!n&&c.data&&c.data.result&&ecEditor._.isArray(c.data.result.domains)&&ecEditor._.forEach(c.data.result.domains,function(n){var a={};a.id=n.identifier,a.name=n.name;var o=[];ecEditor._.forEach(t(n.identifier,c.data.result.dimensions),function(i){var n={};n.id=i.id,n.name=i.name,n.nodes=t(i.id,e.concepts),o.push(n)}),a.nodes=o,i.push(a)})}),this.conceptData=i},getConcept:function(e,t,i,n){var i=i||this;e=e||0,t=t||i.limit;var c={request:{filters:{objectType:["Concept"]},offset:e,limit:i.limit}};ecEditor.getService("search").search(c,function(c,a){!c&&a.data&&a.data.result&&ecEditor._.isArray(a.data.result.concepts)&&(ecEditor._.forEach(a.data.result.concepts,function(e){i.concepts.push(e)}),a.data.result.count>t?(e=a.data.result.count-t,t+=t,i.getConcept(e,t,i,n)):n(i))})},initConceptBrowser:function(e,t){var i=this;-1==i.selectors.indexOf(t.element)&&setTimeout(function(){ecEditor.jQuery("#"+t.element).treePicker({data:i.conceptData,name:"Concepts",picked:t.selectedConcepts,onSubmit:function(e){t.callback(e)},nodeName:"conceptSelector_"+t.element,minSearchQueryLength:1})},1e3)}});'))
org.ekstep.contenteditor.jQuery("body").append($("<script type='text/javascript' src='/content-plugins/org.ekstep.assetbrowser-1.2/editor/recorder/wave/wavesurfer.min.js'>"))
org.ekstep.contenteditor.jQuery("body").append($("<script type='text/javascript' src='/content-plugins/org.ekstep.assetbrowser-1.2/editor/recorder/angular-audio-recorder.js'>"))
org.ekstep.contenteditor.jQuery("body").append($("<script type='text/javascript' src='/content-plugins/org.ekstep.assetbrowser-1.2/editor/libs/angular-inview.js'>"))
org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.assetbrowser","ver":"1.2","shortId":"assetbrowser","author":"Sunil A S","title":"Asset Browser","description":"","publishedDate":"","editor":{"main":"editor/plugin.js","dependencies":[{"type":"js","src":"editor/recorder/wave/wavesurfer.min.js"},{"type":"js","src":"editor/recorder/angular-audio-recorder.js"},{"type":"js","src":"editor/libs/angular-inview.js"}]}},eval('org.ekstep.contenteditor.basePlugin.extend({type:"assetbrowser",initData:void 0,cb:void 0,initialize:function(){var e=this;org.ekstep.contenteditor.api.addEventListener(this.manifest.id+":show",this.initPreview,this);var t=org.ekstep.contenteditor.api.resolvePluginResource(e.manifest.id,e.manifest.ver,"editor/assetBrowser.html"),i=org.ekstep.contenteditor.api.resolvePluginResource(e.manifest.id,e.manifest.ver,"editor/assetbrowserapp.js");org.ekstep.contenteditor.api.getService("popup").loadNgModules(t,i)},initPreview:function(e,t){var i=this;this.cb=t.callback,this.mediaType=t.type,this.search_filter=t.search_filter,org.ekstep.contenteditor.api.getService("popup").open({template:"partials/assetbrowser.html",controller:"browsercontroller",controllerAs:"$ctrl",resolve:{instance:function(){return i}},showClose:!1,className:"ngdialog-theme-plain"})},getAsset:function(e,t,i,r,o){var s,n;s={request:{filters:{mediaType:t,contentType:"Asset",compatibilityLevel:{min:1,max:2},status:new Array("Live","Review","Draft")},limit:50,offset:r}},org.ekstep.contenteditor.api._.isUndefined(e)||(s.request.query=e),org.ekstep.contenteditor.api._.isUndefined(i)?(s.request.filters.license="Creative Commons Attribution (CC BY)",n=org.ekstep.contenteditor.api._.omit(this.search_filter,["mediaType","license","limit"])):(s.request.filters.createdBy=i,n=org.ekstep.contenteditor.api._.omit(this.search_filter,["mediaType","limit","createdBy"])),org.ekstep.contenteditor.api._.merge(s.request.filters,n);org.ekstep.contenteditor.api.getService(ServiceConstants.SEARCH_SERVICE);ecEditor.getService("search").search(s,function(e,t){e||"OK"!=t.data.responseCode?o(e,null):o(null,t)})},showAssetBrowser:function(e,t){},fileValidation:function(e,t,i){if(window.File&&window.FileList&&window.Blob){var r=org.ekstep.contenteditor.api.jQuery("#"+e)[0].files[0].size,o=org.ekstep.contenteditor.api.jQuery("#"+e)[0].files[0].type;return r>t?(alert("File size is higher than the allowed size!"),!1):!o||(-1!=org.ekstep.contenteditor.api.jQuery.inArray(o,i)||(alert("File type is not allowed!"),!1))}return!0}});'))
org.ekstep.contenteditor.jQuery("head").append("<link rel='stylesheet' type='text/css' href='/content-plugins/org.ekstep.uploadcontent-1.0/editor/libs/fine-uploader-new.min.css'>")
org.ekstep.contenteditor.jQuery("head").append("<link rel='stylesheet' type='text/css' href='/content-plugins/org.ekstep.uploadcontent-1.0/editor/styles/uploadcontent.css'>")
org.ekstep.contenteditor.jQuery("body").append($("<script type='text/javascript' src='/content-plugins/org.ekstep.uploadcontent-1.0/editor/libs/jquery.fine-uploader.min.js'>"))
org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.uploadcontent","ver":"1.0","author":"Santhosh Vasabhaktula","title":"Upload Plugin","description":"","publishedDate":"","editor":{"main":"editor/plugin.js","dependencies":[{"type":"css","src":"editor/libs/fine-uploader-new.min.css"},{"type":"css","src":"editor/styles/uploadcontent.css"},{"type":"js","src":"editor/libs/jquery.fine-uploader.min.js"},{"type":"plugin","plugin":"org.ekstep.toaster","ver":"1.0"}]}},eval('"use strict";org.ekstep.contenteditor.basePlugin.extend({callback:void 0,initialize:function(){var e=this;ecEditor.addEventListener(this.manifest.id+":show",this.showUploadForm,this);var t=ecEditor.resolvePluginResource(e.manifest.id,e.manifest.ver,"editor/upload.html"),o=ecEditor.resolvePluginResource(e.manifest.id,e.manifest.ver,"editor/uploadapp.js");ecEditor.getService("popup").loadNgModules(t,o)},showUploadForm:function(e,t){var o=this;o.callback=t,ecEditor.getService("popup").open({template:"partials_org.ekstep.uploadcontent.html",controller:"uploadController",controllerAs:"$ctrl",resolve:{instance:function(){return o}},showClose:!1,closeByDocument:!!ecEditor.getContext("contentId"),closeByEscape:!!ecEditor.getContext("contentId"),width:800,className:"ngdialog-theme-plain"})}});'))
org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.contenteditorfunctions","ver":"1.0","author":"Sunil A S","description":"","publishedDate":"","editor":{"main":"editor/plugin.js","dependencies":[{"type":"plugin","plugin":"org.ekstep.toaster","ver":"1.0"}]}},eval('org.ekstep.contenteditor.basePlugin.extend({editorState:void 0,telemetryService:org.ekstep.contenteditor.api.getService(ServiceConstants.TELEMETRY_SERVICE),lastSaved:void 0,popUpValues:{},contentService:org.ekstep.contenteditor.api.getService(ServiceConstants.CONTENT_SERVICE),popupService:org.ekstep.contenteditor.api.getService(ServiceConstants.POPUP_SERVICE),conflictdialogOptions:{showPlatformPreview:!1},initialize:function(){var e=this;ecEditor.addEventListener("org.ekstep.editorstate:state",this.setEditorState,this),ecEditor.addEventListener("org.ekstep.contenteditor:save",this.resolveSaveFn,this),ecEditor.addEventListener("org.ekstep.contenteditor:save:meta",this.saveMetadata,this),ecEditor.addEventListener("org.ekstep.contenteditor:preview",function(t,o){e.previewContent(o.fromBeginning)},this),ecEditor.addEventListener("org.ekstep.contenteditor:save:force",this.saveBrowserContent,this),ecEditor.addEventListener("org.ekstep.contenteditor:review",this.reviewContent,this),ecEditor.addEventListener("org.ekstep.contenteditor:publish",this.publishContent,this),ecEditor.addEventListener("org.ekstep.contenteditor:reject",this.rejectContent,this),ecEditor.addEventListener("org.ekstep.contenteditor:acceptFlag",this.acceptContentFlag,this),ecEditor.addEventListener("org.ekstep.contenteditor:discardFlag",this.discardContentFlag,this),ecEditor.addEventListener("org.ekstep.contenteditor:retire",this.retireContent,this),ecEditor.addEventListener("org.ekstep.contenteditor:unlistedPublish",this.unlistedPublishContent,this)},setEditorState:function(e,t){t&&(this.editorState=t)},reviewContent:function(e,t){var o=ecEditor.getContext("contentId");ecEditor.getService(ServiceConstants.CONTENT_SERVICE).sendForReview({contentId:o},function(e,o){o&&o.data&&"OK"==o.data.responseCode?ecEditor.dispatchEvent("org.ekstep.toaster:success",{title:"Content sent for review...",position:"topCenter",icon:"fa fa-check-circle"}):ecEditor.dispatchEvent("org.ekstep.toaster:error",{message:"Sending for review failed, please try again later...",position:"topCenter",icon:"fa fa-warning"}),t&&t(e,o)})},resolveSaveFn:function(e,t){switch(ecEditor.getService(ServiceConstants.CONTENT_SERVICE).getContentMeta(ecEditor.getContext("contentId")).mimeType){case"application/vnd.ekstep.ecml-archive":this.saveContent(e,t),this.conflictdialogOptions.showPlatformPreview=!0;break;case"application/vnd.ekstep.content-collection":this.saveCollectionContent(e,t);break;case"application/vnd.ekstep.html-archive":case"application/vnd.ekstep.h5p-archive":case"application/epub":case"video/mp4":case"application/pdf":case"video/x-youtube":case"video/webm":this.saveGenericEditorContent(e,t);break;default:t.callback&&t.callback("unable to resolve save call for the mimetype")}},saveGenericEditorContent:function(e,t){var o=ecEditor._.assign({savingPopup:!0,successPopup:!0,failPopup:!0},t);o.savingPopup&&this.saveNotification("saving"),this._patchContent(t,t.body,o)},saveContent:function(e,t){console.log("Save invoked:",e,t),t=ecEditor._.assign({savingPopup:!0,successPopup:!0,failPopup:!0,callback:function(){}},t),t.savingPopup&&this.saveNotification("saving");var o={};t.contentMeta&&(o=t.contentMeta),o.stageIcons=JSON.stringify(org.ekstep.contenteditor.stageManager.getStageIcons()),org.ekstep.pluginframework.eventManager.dispatchEvent("content:before:save");var n=org.ekstep.contenteditor.stageManager.toECML();o.editorState=JSON.stringify(this.editorState),this._patchContent(o,n,t)},_patchContent:function(e,t,o){var n=this;e&&(e=JSON.parse(angular.toJson(e))),this.patchContent(e,t,function(e,t){e?t&&!ecEditor._.isUndefined(t.responseJSON)?"ERR_STALE_VERSION_KEY"==t.responseJSON.params.err&&n.showConflictDialog(o):o&&o.failPopup&&(o.savingPopup||n.saveNotification(),n.changePopupValues("error")):t&&"OK"==t.data.responseCode&&(o&&o.successPopup&&(o.savingPopup||n.saveNotification(),n.changePopupValues("success")),ecEditor.dispatchEvent("org.ekstep.contenteditor:after-save",{})),"function"==typeof o.callback&&o.callback(e,t)},o)},saveBrowserContent:function(e,t){var o=this;this.fetchPlatformContentVersionKey(function(n){o.resolveSaveFn(e,t)})},patchContent:function(e,t,o,n){var i=this;if(org.ekstep.contenteditor.migration&&org.ekstep.contenteditor.migration.isMigratedContent()){e||(e={}),e.oldContentBody=org.ekstep.contenteditor.migration.getBackupContent();var a=function(a,s){s&&i.contentService.saveContent(org.ekstep.contenteditor.api.getContext("contentId"),e,t,o),a&&n&&n.callback("save action interrupted by user")};i.showMigratedContentSaveDialog(a)}else i.contentService.saveContent(org.ekstep.contenteditor.api.getContext("contentId"),e,t,o)},saveMetadata:function(e,t){this._patchContent(t.contentMeta,void 0,t)},showMigratedContentSaveDialog:function(e){var t=this;this.popupService.open({template:ecEditor.resolvePluginResource(t.manifest.id,t.manifest.ver,"editor/partials/migratedContentSaveMsg.html"),controller:["$scope",function(o){o.saveContent=function(){org.ekstep.contenteditor.migration.clearMigrationFlag(),e(void 0,!0)},o.enableSaveBtn=function(){t.saveBtnEnabled=!0,e(!0,void 0)}}],showClose:!1,closeByDocument:!1,closeByEscape:!1})},saveNotification:function(e){var t=this,o={template:ecEditor.resolvePluginResource(t.manifest.id,t.manifest.ver,"editor/partials/saveMessage.html"),controller:["$scope",function(e){e.popUpValues=t.popUpValues}],showClose:!1,closeByEscape:!1,closeByDocument:!1};console.log("config",o),this.changePopupValues(e),this.popupService.open(o)},changePopupValues:function(e){"success"===e?(this.popUpValues.headerMsg="Content Saved!",this.popUpValues.popUpIcon="circle check green",this.popUpValues.showCloseButton=!0,this.popUpValues.saveNotificationCloseButton="saveSuccessNotificationCloseButton"):"error"===e&&(this.popUpValues.headerMsg="Failed to save Content",this.popUpValues.popUpIcon="circle remove red",this.popUpValues.showCloseButton=!0,this.popUpValues.saveNotificationCloseButton="saveFailNotificationCloseButton"),"saving"===e&&(this.popUpValues.headerMsg="Saving content please wait...",this.popUpValues.showCloseButton=!1)},showConflictDialog:function(e){var t=this;this.popupService.open({template:ecEditor.resolvePluginResource(t.manifest.id,t.manifest.ver,"editor/partials/conflictDialog.html"),controller:["$scope",function(o){o.showPlatformPreview=!1,t.conflictdialogOptions.showPlatformPreview&&(o.showPlatformPreview=!0),o.previewPlatformContent=function(){t.previewPlatformContent()},o.saveBrowserContent=function(){t.saveBrowserContent(void 0,e),o.closeThisDialog()},o.previewContent=function(){t.previewContent()},o.refreshContent=function(){t.refreshContent()},o.firetelemetry=function(e,o){t.telemetryService.interact({type:"click",subtype:"popup",target:o,pluginid:"org.ekstep.contenteditorfunctions",pluginver:"1.0",objectid:e.id,stage:ecEditor.getCurrentStage().id})},o.showAdvancedOption=!1}],className:"ngdialog-theme-plain header-conflict-dialog",showClose:!1,closeByDocument:!0,closeByEscape:!0})},previewContent:function(e){var t=!!_.isUndefined(e);org.ekstep.pluginframework.eventManager.dispatchEvent("atpreview:show",{contentBody:org.ekstep.contenteditor.stageManager.toECML(),currentStage:t})},refreshContent:function(){location.reload()},previewPlatformContent:function(){this.fetchPlatformContentBody(function(e){org.ekstep.pluginframework.eventManager.dispatchEvent("atpreview:show",{contentBody:e,currentStage:!0})})},fetchPlatformContentVersionKey:function(e){org.ekstep.contenteditor.api.getService(ServiceConstants.CONTENT_SERVICE).getContentVersionKey(org.ekstep.contenteditor.api.getContext("contentId"),function(t,o){t&&alert("Failed to get updated version key. Please report an issue."),o.versionKey&&e(o)})},fetchPlatformContentBody:function(e){org.ekstep.contenteditor.api.getService(ServiceConstants.CONTENT_SERVICE).getContent(org.ekstep.contenteditor.api.getContext("contentId"),function(t,o){if(t&&alert("Failed to get updated content. Please report an issue."),o&&o.body)try{var n=JSON.parse(o.body);e(n)}catch(e){alert("Failed to parse body from platform. Please report an issue.")}})},publishContent:function(e,t){var o=ecEditor.getContext("contentId");ecEditor.getService(ServiceConstants.CONTENT_SERVICE).publishContent({contentId:o},function(e,o){o&&o.data&&"OK"==o.data.responseCode?ecEditor.dispatchEvent("org.ekstep.toaster:success",{title:"Content published successfully!",position:"topCenter",icon:"fa fa-check-circle"}):ecEditor.dispatchEvent("org.ekstep.toaster:error",{message:"Unable to publish content, try again!",position:"topCenter",icon:"fa fa-warning"}),t.callback&&t.callback(e,o)})},rejectContent:function(e,t){ecEditor.getService(ServiceConstants.CONTENT_SERVICE).rejectContent({contentId:ecEditor.getContext("contentId")},function(e,o){o&&o.data&&"OK"==o.data.responseCode?ecEditor.dispatchEvent("org.ekstep.toaster:success",{title:"Content rejected successfully!",position:"topCenter",icon:"fa fa-check-circle"}):ecEditor.dispatchEvent("org.ekstep.toaster:error",{message:"Unable to reject content, try again!",position:"topCenter",icon:"fa fa-warning"}),t.callback&&t.callback(e,o)})},acceptContentFlag:function(e,t){ecEditor.getService(ServiceConstants.CONTENT_SERVICE).acceptContentFlag({contentId:ecEditor.getContext("contentId")},function(e,o){o&&o.data&&"OK"==o.data.responseCode?ecEditor.dispatchEvent("org.ekstep.toaster:success",{title:"Content flag accepted successfully!",position:"topCenter",icon:"fa fa-check-circle"}):ecEditor.dispatchEvent("org.ekstep.toaster:error",{message:"Unable to accept content flag, try again!",position:"topCenter",icon:"fa fa-warning"}),t.callback&&t.callback(e,o)})},discardContentFlag:function(e,t){ecEditor.getService(ServiceConstants.CONTENT_SERVICE).discardContentFlag({contentId:ecEditor.getContext("contentId")},function(e,o){o&&o.data&&"OK"==o.data.responseCode?ecEditor.dispatchEvent("org.ekstep.toaster:success",{title:"Content flag discarded successfully!",position:"topCenter",icon:"fa fa-check-circle"}):ecEditor.dispatchEvent("org.ekstep.toaster:error",{message:"Unable to discard content flag, try again!",position:"topCenter",icon:"fa fa-warning"}),t.callback&&t.callback(e,o)})},retireContent:function(e,t){ecEditor.getService(ServiceConstants.CONTENT_SERVICE).retireContent({contentId:ecEditor.getContext("contentId")},function(e,o){o&&o.data&&"OK"==o.data.responseCode?ecEditor.dispatchEvent("org.ekstep.toaster:success",{title:"Content retired successfully!",position:"topCenter",icon:"fa fa-check-circle"}):ecEditor.dispatchEvent("org.ekstep.toaster:error",{message:"Unable to retire content, try again!",position:"topCenter",icon:"fa fa-warning"}),t.callback&&t.callback(e,o)})},saveCollectionContent:function(e,t){t=t||{};var o=org.ekstep.collectioneditor.api.getService("collection").getCollectionHierarchy();o&&(o=JSON.parse(angular.toJson(o))),console.log("contentBody",o);if(!function(){var e=!0,t=["name","contentType","description","mimeType"];return ecEditor._.forIn(org.ekstep.collectioneditor.cache.nodesModified,function(o,n){o.isNew&&t.forEach(function(t){o.metadata.hasOwnProperty(t)||(e=!1)})}),e}())return t.showNotification&&ecEditor.dispatchEvent("org.ekstep.toaster:error",{message:"Please update the collection details before save",position:"topCenter",icon:"fa fa-warning"}),t.callback&&t.callback("mandatory fields are missing in the data!"),!1;ecEditor.getService(ServiceConstants.CONTENT_SERVICE).saveCollectionHierarchy({body:o},function(e,o){o&&o.data&&"OK"==o.data.responseCode?(t.showNotification&&ecEditor.dispatchEvent("org.ekstep.toaster:success",{title:"Content saved successfully!",position:"topCenter",icon:"fa fa-check-circle"}),org.ekstep.collectioneditor.api.getService("collection").clearCache(),ecEditor._.forIn(o.data.result.identifiers,function(e,t){var o=ecEditor.getService(ServiceConstants.COLLECTION_SERVICE).getNodeById(t);o&&(o.data.id=e)})):t.showNotification&&ecEditor.dispatchEvent("org.ekstep.toaster:error",{message:"Unable to save the content, try again!",position:"topCenter",icon:"fa fa-warning"}),t.callback&&t.callback(e,o)})},unlistedPublishContent:function(e,t){var o=ecEditor.getContext("contentId");ecEditor.getService(ServiceConstants.CONTENT_SERVICE).unlistedPublishContent({contentId:o},function(e,o){o&&o.data&&"OK"==o.data.responseCode?ecEditor.dispatchEvent("org.ekstep.toaster:success",{title:"Content limited shared successfully!",position:"topCenter",icon:"fa fa-check-circle"}):ecEditor.dispatchEvent("org.ekstep.toaster:error",{message:"Unable to share content, try again!",position:"topCenter",icon:"fa fa-warning"}),t.callback&&t.callback(e,o)})}});'))
